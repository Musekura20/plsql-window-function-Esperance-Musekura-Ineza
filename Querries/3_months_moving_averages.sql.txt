--3 month moving averages--
SELECT TO_CHAR(t.sale_date, 'YYYY-MM') AS month, SUM(t.amount) AS monthly_sales,
ROUND(AVG(SUM(t.amount)) OVER (ORDER BY TO_CHAR(t.sale_date, 'YYYY-MM') ROWS BETWEEN 2 PRECEDING AND CURRENT ROW), 2) AS moving_avg_3months from transactions t group by TO_CHAR(t.sale_date, 'YYYY-MM') order by month;
