--Top 5 selling products per region/quarter 
SELECT c.region, EXTRACT(QUARTER FROM t.sale_date) AS sale_quarter, p.name AS product_name, SUM(t.amount) AS total_sales,
-- Ranking functions
--Row number to give unique numbers to each row
ROW_NUMBER() OVER (PARTITION BY c.region, EXTRACT(QUARTER FROM t.sale_date) ORDER BY SUM(t.amount) DESC) AS row_nbr,
--Rank top products by total sales amount
RANK() OVER (PARTITION BY c.region, EXTRACT(QUARTER FROM t.sale_date) ORDER BY SUM(t.amount) DESC) AS rank_val,
DENSE_RANK() OVER (PARTITION BY c.region, EXTRACT(QUARTER FROM t.sale_date) ORDER BY SUM(t.amount) DESC) AS dense_rank,
PERCENT_RANK() OVER (PARTITION BY c.region, EXTRACT(QUARTER FROM t.sale_date) ORDER BY SUM(t.amount) DESC) AS percent_rank
FROM transactions t
JOIN customer c ON t.customer_id = c.customer_id
JOIN products p ON t.product_id = p.product_id
GROUP BY c.region, sale_quarter, p.name
ORDER BY c.region, sale_quarter, rank_val;

